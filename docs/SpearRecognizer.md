# SpearRecognizer-Python v1.0.0

`spear/SpearRecognizer.py` provides access to the SPEAR ASR Engine. It's generated by SWIG. This
document will show you how to apply SPEAR ASR Engine in your python code.

## Initialize a SPEAR ASR Engine

#### Initialize(dataDirectory)
User needs to call the function `Initialize` to get a SPEAR ASR Engine.

 * **Parameters:**
    * `dataDirectory` - Absolute path of the model folder on the device. 

Here is the sample code,

```
from spear import SpearRecognizer

engine = SpearRecognizer.Initialize('assets/resources/SPEAR-DATA-EN/SPEAR-ASR/')
```

## Create a profile
Before creating a recognizer, the user needs to firstly create a profile using `ProfileLoadUntrained`.

#### ProfileLoadUntrained(spear_engine, profile_type, sample_rate)

 * **Parameters:**
    * `spear_engine` - An instance of spear engine.
    * `profile_type` — The type of profile, which allows {0: TAM_INDEPENDENT, 1: TAM_MALE, 2: TAM_FEMALE}.
    * `sample_rate` - The sample rate for feature extraction, which allows {0: TAM_16K, 1: TAM_8K}.

Here is the sample code,

```
profile = SpearRecognizer.ProfileLoadUntrained(engine, 0, 0)
```

## Create grammars

The recognizer of SPEAR ASR Engine needs grammars to do its work. The user can load a pre-trained
fst file as a grammar or compile a set of regex strings to get one.

#### GrammarLoad(grammar_path)

This function loads a pre-trained fst file and returns a grammar object.

 * **Parameters:**
    * `grammar_path` — Absolute path of the fst file on the device.

Here is the sample code,

```
aviation_grammar = SpearRecognizer.GrammarLoad('assets/resources/Fsts/aviation_JL16k-NA_v4.fst')
```

#### GrammarCompile(spear_engine, regEx, type, rate, continuous)
Besides the above `GrammarLoad` function, user can also create customized grammar by using this
function.

 * **Parameters:**
    * `spear_engine` — An instance of SPEAR ASR Engine.
    * `regEx` - A set of regex strings as rules to create the grammar. Please see
      `SpearSdkExample-Python/commands/CommandList.py` and `GrammarSyntax.md` for more details about
      how to create regex strings for grammar.
    * `type`, `rate` and `continuous` are all reserved and useless for now. They can all be safely set as 0.


## Initialize a recognizer

#### RecognizerInit(spear_engine, profile, grammar, recMode)
This function is used to initialize a recognizer.

 * **Parameters:**
    * `spear_engine` — An instance of SPEAR ASR Engine.
    * `profile` - Profile created by using the function `ProfileLoadUntrained`.
    * `grammar` - Grammar created by using the function `GrammarLoad` or `GrammarCompile`.
    * `recMode` - reserved and useless for now. It can be safely set as 0.

## Run the recognizer
After getting the engine and the recognizer, the user can start running the recognizer to process
the incoming audio.

#### RecognizerContinuousProcess(rec, buffer, commit_callback)
This function is to start the recognition process.
 
 * **Parameters:**
    * `rec` — Recognizer object created by using the function `RecognizerInit`.
    * `buffer` — A python list contains raw wave data.
    * `commit_callback` - A callback function that uses to handle the result returned from engine.
                          See `SpearRecognizerCallback class` section below for more details.

#### ChangeGrammar(rec, grammar)
While the recognizer is running, user can change the grammar using this function to switch between
different tasks.

 * **Parameters:**
    * `rec` — Recognizer object created by using the function `RecognizerInit`.
    * `grammar` - Grammar created by using the function `GrammarLoad` or `GrammarCompile`.

#### RecognizerStop(rec)
User can call this function to stop the ongoing recognizer.

 * **Parameters:**
    * `rec` — Recognizer object created by using the function `RecognizerInit`.

## SpearRecognizerCallback class

This `SpearRecognizerCallback` class is used for letting user create customized python function as callback 
function and pass it to `RecognizerContinuousProcess`.

The user needs to inherit `SpearRecognizerCallback` class and rewrite `onCommitResult` method. The
`onCommitResult` is the callback function that will be called after each time the engine processed a
chunk of data.

#### onCommitResult(self, arg0, arg1)

 * **Parameters:**
    * `arg0` — userdata, which is useless and can be safely omitted.
    * `arg1` - N-best transcription results returned by the recognizer.

Here is the sample code that shows how to inherit the class and rewrite the `onCommitResult` method.

```
class RecognizerCallback(SpearRecognizer.SpearRecognizerCallback):
    def __init__(self):
        SpearRecognizer.SpearRecognizerCallback.__init__(self)
        self.result = ""

    def onCommitResult(self, arg0, arg1):
        self.result = arg1.transcriptionPairs.transcription
```

And here is the sample code that shows how to use the above `RecognizerCallback` class.
```
handler = RecognizerCallback()
s_recognizer_process_ok = SpearRecognizer.RecognizerContinuousProcess(recognizer, data_samples, handler)
```

