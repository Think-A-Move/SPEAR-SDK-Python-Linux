# SpearWakeUp-Python v1.0.0

`spear/SpearWakeUp.py` provides access to the SPEAR WakeUp Engine. It's generated by SWIG. This
document will show you how to apply SPEAR WakeUp Engine in your python code.

## SpearWakeUpEngine class

This `SpearWakeUpEngine` class contains all the methods you need to create a wake-word engine,
start and stop the engine.

### Instantiate a SPEAR WakeUp Engine

```
from spear import SpearWakeUp

engine = SpearWakeUp.SpearWakeUpEngine()
```

### Initialize the created engine

After creating the engine, the user needs to initialize it with resources. There are two ways to
do that.

##### InitWithFst(self, model_dir, fst_file)

Initializes Spear WakeUp Engine with the model folder and the pre-compiled WakeUp grammar (FST).

 * **Parameters:**
    * `model_dir` - Absolute path of the model folder on the device. 
    * `fst_file` — Absolute path of the FST file on the device.

Here is the sample code,

```
engine.InitWithFst("assets/resources/SPEAR-DATA-EN/SPEAR-WakeUp", "assets/resources/Fsts/heyspear.fst")
```

##### InitWithWakeWord(self, model_dir, wake_word)

Initializes Spear WakeUp Engine with the model folder and a specified wake-word. Please note that,

 * **Parameters:**
    * `wakeWord` — A wakeUp word. Long sentences as wakeUp word is not recommended. We
     recommend to use one to three words as WakeUp word. If there is only one word, it should contain
     at least two syllables to get better accuracy.

Here is the sample code,

```
engine.InitWithFst("assets/resources/SPEAR-DATA-EN/SPEAR-WakeUp", "HEY SPEAR")
```

### Start process

After initializing the engine using one of the above two methods, user can start processing the input audio
by calling the method `ProcessTask`.

##### ProcessTask(self, package_buf, commit_callback)

 * **Parameters:**
    * `package_buf` — A python list contains raw wave data.
    * `commit_callback` - A callback function that uses to handle the result returned from engine. See
                          `SpearWakeUpCallback class` section below for more details.

### Stop process

Stop the ongoing processing by calling the method `StopTask`.

##### StopTask(self, commit_callback)

 * **Parameters:**
    * `commit_callback` - A callback function that uses to handle the result returned from engine. See
                          `SpearWakeUpCallback class` section below for more details.

## SpearWakeUpCallback class

This `SpearWakeUpCallback` class is used for letting user create customized python function as callback 
function and pass it to `ProcessTask` and `StopTask` methods.

The user needs to inherit `SpearWakeUpCallback` class and rewrite `onCommitResult` method. The
`onCommitResult` is the callback function that will be called after each time the engine processed a
chunk of data.

##### onCommitResult(self, arg0)

 * **Parameters:**
    * `arg0` — An object that contains the value `retval` returned from the engine. The definition of
               arg0.retval is *-1: TOO_SMALL_PACKAGE, 0: NOT_WAKEUP, 1: IS_WAKEUP*.

Here is the sample code that shows how to inherit the class and rewrite the `onCommitResult` method.

```
class WakeUpCallback(SpearWakeUp.SpearWakeUpCallback):
    def __init__(self):
        super().__init__()
        self.is_wakeup = False

    def onCommitResult(self, arg0):
        if (arg0.retval == 1):
            self.is_wakeup = True
        else:
            self.is_wakeup = False

    def wakeup(self):
        return self.is_wakeup
```

There is one thing that the user needs to be noticed. To make the callback function work in SWIG, the
callback function `onCommitResult` can't be directly passed. That's why the user needs to call
`createWrapper` method to create a wrapper of `OnCommitResult` and then pass this wrapper to `ProcessTask`
and `StopTask`. The sample code below shows how to use the `WakeUpCallback` metioned above.

```
wakeup_callback = WakeUpCallback()
callback_wrapper = wakeup_callback.createWrapper()
engine.ProcessTask(data_samples, callback_wrapper)
```

